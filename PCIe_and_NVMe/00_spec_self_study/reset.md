## âœï¸ Reset ë‚´ìš© ì •ë¦¬ âœï¸

### ğŸ“œAgenda

- [âœ… 1. Conventional Reset](#-1-conventional-reset)
- [âœ… 2. Fundamental Reset](#-2-fundamental-reset)
- [âœ… 3. Cold Reset](#-3-cold-reset)
- [âœ… 4. Warm Reset](#-4-warm-reset)
- [âœ… 5. Hot Reset](#-5-hot-reset)
- [âœ… 6. Non-Fundamental Reset](#-6-non-fundamental-reset)
- [âœ… 7. Function Level Reset (FLR)](#-7-function-level-reset-flr)
- [âœ… ì¶”ê°€) NVMe Reset ì´í›„ ì´ˆê¸°í™” ì ˆì°¨ ë° Admin Queue ì •ë¦¬](#-ì¶”ê°€-nvme-reset-ì´í›„-ì´ˆê¸°í™”-ì ˆì°¨-ë°-admin-queue-ì •ë¦¬)
  <br>
  
### â–¶ï¸ Resetì˜ ì¢…ë¥˜

<img src="assets/reset.png" width="550"/>

<br>

### âœ… 1. Conventional Reset 

ğŸ”¸ì „í†µì ì¸ ì˜ë¯¸ì˜ Resetìœ¼ë¡œ, Device ì „ì²´ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ëŠ” ë¦¬ì…‹ ë°©ë²•

ğŸ”¸ì£¼ë¡œ ì „ì›ì´ë‚˜ ë¦¬ì…‹ ì‹ í˜¸(PERST#)ì„ í†µí•´ì„œ íŠ¸ë¦¬ê±° ë¨

### âœ… 2. Fundamental Reset

ğŸ”¸Device ì „ì²´ ë¥¼ ì „ì› ì¸ê°€ ì§í›„ ìƒíƒœë¡œ ë˜ëŒë¦¬ëŠ” ë¦¬ì…‹ ë°©ì‹

ğŸ”¸ì „ì› ìˆ˜ì¤€, ë²”ìœ„ ë“±ì— ë”°ë¼ Cold, Warm, Hotìœ¼ë¡œ ë‚˜ë‰˜ì–´ì§„ë‹¤.

### âœ… 3. Cold Reset

#### 1) ê°œë…

ğŸ”¸ë””ë°”ì´ìŠ¤ ì „ì›ì„ ê»ë‹¤ê°€ ì¼œëŠ” ê²ƒê³¼ ë™ì¼í•œ íš¨ê³¼ë¥¼ ì£¼ëŠ” ë¦¬ì…‹ ë°©ì‹ìœ¼ë¡œ, í•˜ë“œì›¨ì–´ ì°¨ì›ì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ì™„ì „íˆ ì´ˆê¸°í™”í•œë‹¤.

ğŸ”¸ PCIe ì¥ì¹˜ëŠ” ë§ˆì¹˜ ì‹œìŠ¤í…œ ë¶€íŒ… ì‹œ ì „ì›ì„ ì²˜ìŒ ì¸ê°€ë°›ì€ ê²ƒì²˜ëŸ¼ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒì•„ê°„ë‹¤.

ğŸ”¸ ë‹¨ìˆœíˆ íë‚˜ ë ˆì§€ìŠ¤í„°ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, ì „ì› ì°¨ë‹¨ì„ ìˆ˜ë°˜í•˜ë¯€ë¡œ íœ˜ë°œì„± ë©”ëª¨ë¦¬(DRAM, MMIO ë“±)ë„ ëª¨ë‘ ì†Œë©¸ëœë‹¤.

> ì¦‰, ì†Œí”„íŠ¸ì›¨ì–´ ë¦¬ì…‹ì´ ì•„ë‹Œ í•˜ë“œì›¨ì–´ ë¦¬ì…‹,ë””ë°”ì´ìŠ¤ ìì²´ë¥¼ *â€œë‹¤ì‹œ ì¼ ë‹¤â€* ëŠ” ê°œë…ì´ê¸° ë•Œë¬¸ì— ê°€ì¥ ê°•ë ¥í•˜ê³  í¬ê´„ì ì¸ ë¦¬ì…‹ ë°©ì‹ì´ë‹¤.

#### 2) Cold Reset íŠ¸ë¦¬ê±° ë°©ì‹

ğŸ”¶ **í•˜ë“œì›¨ì–´ ê¸°ë°˜ ë¦¬ì…‹**

ğŸ”¸ PERST# í•€(Power-on Reset Signal) ì´ Assertë  ë•Œ ë°œìƒ

 > PERST#ëŠ” Active-Low (Lowì¼ ë•Œ ë¦¬ì…‹ ì‘ë™)

ğŸ”¸ ì´ ì‹ í˜¸ëŠ” ì „ì› ê³µê¸‰ íšŒë¡œë‚˜ ì¹©ì…‹, ë¦¬ì…‹ ë²„íŠ¼, BMC ë“±ì— ì˜í•´ ì œì–´ë  ìˆ˜ ìˆë‹¤.

ğŸ”· **ì‹œìŠ¤í…œ ë ˆë²¨ ì „ì› ê´€ë¦¬**

ğŸ”¹ ì „ì› ë¶ˆì•ˆì •, ì‹œìŠ¤í…œ ì „ì› Off/On, ë¦¬ì…‹ ìŠ¤ìœ„ì¹˜ ë“±ìœ¼ë¡œë„ ë°œìƒ

 > BIOS/UEFI ë˜ëŠ” ACPIê°€ í”Œë«í¼ ë ˆë²¨ì—ì„œ ì „ì› ë¦¬ì‚¬ì´í´ì„ ìœ ë„í•¨

ğŸ”¹ Power Cycling ë˜ëŠ” Platform Reset ì´ë²¤íŠ¸ë„ Cold Reset íŠ¸ë¦¬ê±° ê°€ëŠ¥

ğŸ”¹ âš ï¸ ìˆœìˆ˜ ì „ì› ê¸°ë°˜ ë¦¬ì…‹ì´ë¯€ë¡œ ì½”ë“œë¡œëŠ” êµ¬í˜„ ë¶ˆê°€ (ì†Œí”„íŠ¸ì›¨ì–´ ëª…ë ¹ìœ¼ë¡œëŠ” ë¶ˆê°€ëŠ¥)

#### 3) Cold Reset ë™ì‘ ê³¼ì •

1ï¸âƒ£ PERST#ê°€ Assertë¨ (Active Low)

* ë””ë°”ì´ìŠ¤ê°€ ë¦¬ì…‹ ìƒíƒœë¡œ ì§„ì…

* ë‚´ë¶€ ìƒíƒœ ë¨¸ì‹ , ë ˆì§€ìŠ¤í„°, ë²„í¼, DRAM ë“± íœ˜ë°œì„± ì •ë³´ ëª¨ë‘ ì´ˆê¸°í™”ë¨

2ï¸âƒ£ ì „ì› ê³µê¸‰ â†’ ë””ë°”ì´ìŠ¤ ì „ì› ì¸ê°€ ì§í›„ ìƒíƒœë¡œ ë³µê·€

* ROM(ë‚´ì¥ íŒì›¨ì–´)ì—ì„œ ì´ˆê¸°í™” ì½”ë“œ ë¡œë”©

* ê¸°ë³¸ ì„¸íŒ…ê°’ìœ¼ë¡œ ì´ˆê¸°í™” ìˆ˜í–‰

3ï¸âƒ£ Configuration Space ì´ˆê¸°í™”

* Device ID, Vendor ID, Class Code, BAR ë“± ëª¨ë‘ ì´ˆê¸°ê°’ìœ¼ë¡œ ë³µê·€

4ï¸âƒ£ Link Training ì¬ì‹œì‘

* LTSSM(Link Training and Status State Machine) ìƒíƒœ ë¨¸ì‹  ë™ì‘

* Root Complex â†” Endpoint ê°„ PCIe ë§í¬ ì¬í˜‘ìƒ ìˆ˜í–‰

5ï¸âƒ£ ì •ìƒ ë™ì‘ ìƒíƒœ ë³µê·€ (L0 ì§„ì…)

* Link ìƒíƒœê°€ L0(Active)ë¡œ ì§„ì… â†’ ë””ë°”ì´ìŠ¤ ì‚¬ìš© ê°€ëŠ¥

####  4) NVMeê´€ì ì—ì„œì˜ ì˜í–¥

ğŸ”¸ Cold Resetì€ PCIe ë ˆë²¨ ë¦¬ì…‹ì´ê¸° ë•Œë¬¸ì—, NVMe ë””ë°”ì´ìŠ¤ë„ ì´ˆê¸°í™” ëŒ€ìƒì´ë‹¤.

ğŸ”¸ NVMe Controller ë‚´ë¶€ì˜ CC(Control Register), CSTS(Status Register), í, ë©”ëª¨ë¦¬ ë§µ, Identify ì •ë³´ê¹Œì§€ ëª¨ë‘ ì‚­ì œë¨

ğŸ”¸ OS ì…ì¥ì—ì„œëŠ” ë””ë°”ì´ìŠ¤ê°€ ì‹œìŠ¤í…œì—ì„œ ì™„ì „íˆ ì‚¬ë¼ì¡Œë‹¤ê°€ ë‹¤ì‹œ ì¥ì°©ëœ ê²ƒì²˜ëŸ¼ ì¸ì‹

ğŸ”¸ ì´í›„ ë“œë¼ì´ë²„ê°€ ë‹¤ì‹œ BAR í• ë‹¹, Identify ëª…ë ¹ ìˆ˜í–‰, í ì¬ìƒì„± ë“±ì˜ ì ˆì°¨ë¥¼ í†µí•´ ì¬ì‚¬ìš© ê°€ëŠ¥

### âœ… 4. Warm Reset

#### 1) ê°œë…

ğŸ”¸**ì „ì›ì€ ìœ ì§€í•œ ìƒíƒœ**ì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ë¦¬ì…‹ ë°©ì‹

> *ë””ë°”ì´ìŠ¤ì˜ ë‚´ë¶€ ë…¼ë¦¬ íšŒë¡œ, ìƒíƒœ ë¨¸ì‹  ë“±ì„ ì´ˆê¸°í™”í•˜ì§€ë§Œ ì „ì› ê³µê¸‰ì€ ê³„ì†ë¨*
>
> *ì „ì›ì„ ë„ì§€ ì•Šê³ ë„ ë¦¬ì…‹í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì—ì„œ Cold Resetê³¼ ì°¨ì´ê°€ ìˆìŒ*

ğŸ”¸ë””ë°”ì´ìŠ¤ì˜ Configuration SpaceëŠ” ì´ˆê¸°í™”ë˜ë©°, Link Trainingë„ ì¬ì§„í–‰

> *Configuration Space : PCIe ë””ë°”ì´ìŠ¤ì˜ ì†ì„±, ì œì–´ ì •ë³´, ìƒíƒœ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ê³µê°„*
>
> *Link Trainingì€ PCIe : Root Complexì™€ Endpointê°€ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ê¸° ì „ì— ë§í¬ë¥¼ ì„¤ì •í•˜ëŠ” ê³¼ì •*
>
>> *`Root Complex (RC)` : CPUì™€ ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œì„ PCIeë¡œ ì—°ê²°í•´ì£¼ëŠ” ë¸Œë¦¬ì§€ë¡œ, PCIe ë„¤íŠ¸ì›Œí¬ì˜ ì¶œë°œì ì„ ì˜ë¯¸í•¨*
>> 
>> *`Endpoint (EP)` : Root Complexì— ì—°ê²°ëœ ìµœì¢… PCIe ë””ë°”ì´ìŠ¤ë¡œ, Root Complexë‘ ì—°ê²°ëœ ì§„ì§œ ì¼í•˜ëŠ” ì¥ì¹˜ë“¤ì„ ì˜ë¯¸í•¨*

#### 2) Warm Reset íŠ¸ë¦¬ê±° ë°©ì‹

ğŸ”¶ **ì†Œí”„íŠ¸ì›¨ì–´ ì œì–´ ë°©ì‹**

ğŸ”¸Root Complexê°€ ì†Œí”„íŠ¸ì›¨ì–´ì ìœ¼ë¡œ ë¦¬ì…‹ì„ íŠ¸ë¦¬ê±°.

ğŸ”¸Root Portë‚˜ Downstream Portì—ì„œ Warm Resetì„ Initiate.

ğŸ”· **í•˜ë“œì›¨ì–´ëŠ” ìœ ì§€**

ğŸ”¹ì „ì›ì€ ë„ì§€ ì•Šê³ , PERST#ëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ.

#### 3) Warm Reset ë™ì‘ ê³¼ì •

1ï¸âƒ£ Root Complexê°€ Warm Reset Initiate

* ë””ë°”ì´ìŠ¤ ë¦¬ì…‹ì„ ìœ„í•´ ë‚´ë¶€ ì‹œí€€ìŠ¤ ì‹œì‘

2ï¸âƒ£ ë””ë°”ì´ìŠ¤ ë…¼ë¦¬ íšŒë¡œ ì´ˆê¸°í™”

* ë‚´ë¶€ ë ˆì§€ìŠ¤í„°, ìƒíƒœ ë¨¸ì‹  ì´ˆê¸°í™”.

* ì†Œí”„íŠ¸ì›¨ì–´ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í•´ë‹¹ ë””ë°”ì´ìŠ¤ë¥¼ ë¦¬ì…‹.

3ï¸âƒ£ Configuration Space ì´ˆê¸°í™”

* PCIe Config Space (Header Registers, Capability Registers ë“±) ì´ˆê¸°í™”.

4ï¸âƒ£ Link Training ì¬ì‹œì‘

* LTSSM(Link Training Status State Machine) ì¬ì§„ì….

* Root Complexì™€ Endpoint ê°„ Link ì¬í˜‘ìƒ.

5ï¸âƒ£ ì •ìƒ ë™ì‘ ìƒíƒœë¡œ ë³µê·€

* L0 (Active State)ë¡œ ì§„ì… í›„ ì •ìƒ ìš´ì˜.

### âœ… 5. Hot Reset

#### 1) ê°œë…

ğŸ”¸ë””ë°”ì´ìŠ¤ë‚˜ í•˜ìœ„ Bus ë ˆë²¨ì—ì„œ ìˆ˜í–‰í•˜ëŠ” ë¦¬ì…‹ ë°©ì‹ìœ¼ë¡œ PCIe ë§í¬ ìƒì—ì„œ ì—°ê²°ì„ ëŠê³  ì¬ì—°ê²°í•¨.

ğŸ”¸Cold/Warm Resetì²˜ëŸ¼ ë””ë°”ì´ìŠ¤ ì „ì²´ ì´ˆê¸°í™”ë¥¼ ìœ ë„í•˜ì§€ë§Œ, **ì „ì›ì„ ë„ì§€ ì•Šê³  ìˆ˜í–‰**ëœë‹¤.

> ì „ì›ì€ ê³„ì† ì—°ê²°ë˜ì–´ ìˆê³  ì‹ í˜¸ë§Œ ëŠìŒìœ¼ë¡œì¨ *â€œë‹¤ì‹œ ì—°ê²°ë˜ì—ˆêµ¬ë‚˜â€* ë¼ê³  ëŠë¼ê²Œ ë§Œë“¤ì–´ Link ì¬í˜‘ìƒ(link re-training) ì„ ê°•ì œë¡œ ìœ ë„í•œë‹¤.

ğŸ”¸Link Trainingì€ ë‹¤ì‹œ ìˆ˜í–‰í•˜ì§€ë§Œ, ì „ì›ì€ ìœ ì§€ë˜ê³  PERST#ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

> í”íˆ *â€œPCIe ì¥ì¹˜ë¥¼ ëºë‹¤ ë‹¤ì‹œ ê½‚ì€ ê²ƒì²˜ëŸ¼â€* ì‘ë™í•˜ë©°, ì‹¤ì œë¡œ LTSSM ìƒíƒœê°€ L0 â†’ Detect â†’ Polling â†’ L0ë¡œ ì „ì´ë¨.

ğŸ”¸PCI-to-PCI ë¸Œë¦¬ì§€ë‚˜ PCIe ìŠ¤ìœ„ì¹˜ì˜ Bridge Control Register ë‚´ **"Secondary Bus Reset Bit"** ë¥¼ í†µí•´ íŠ¸ë¦¬ê±°

> `Secondary Bus Reset Bit` : PCIe ë¸Œë¦¬ì§€ ì¥ì¹˜ì˜ Bridge Control Registerì— ìˆëŠ” ë¦¬ì…‹ ì œì–´ ë¹„íŠ¸
>
> ì´ ë¹„íŠ¸ë¥¼ 1ë¡œ ì„¤ì •í•˜ë©´, ë¸Œë¦¬ì§€ ì•„ë˜ìª½(Secondary Bus)ì— ì—°ê²°ëœ ëª¨ë“  ë””ë°”ì´ìŠ¤ë“¤ì´ ë¦¬ì…‹

#### 2) Hot Reset íŠ¸ë¦¬ê±° ë°©ì‹

ğŸ”¶ **ì†Œí”„íŠ¸ì›¨ì–´ ì œì–´ ë°©ì‹**

ğŸ”¸Root Complexê°€ PCI Configuration Spaceì˜ Secondary Bus Reset Bitë¥¼ Writeí•˜ì—¬ íŠ¸ë¦¬ê±°

ğŸ”¸PCI-to-PCI ë¸Œë¦¿ì§€ ì¥ì¹˜ë‚˜ PCIe ìŠ¤ìœ„ì¹˜ì—ì„œ ì£¼ë¡œ ì‚¬ìš©

ğŸ”¸ì§ì ‘ì ì¸ ì „ì› ì œì–´ë‚˜ PERST# í•€ì€ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤

ğŸ”· **ë²”ìœ„ëŠ” â€œBus ë‹¨ìœ„â€**

ğŸ”¹Hot Resetì€ ë‹¨ì¼ ë””ë°”ì´ìŠ¤ê°€ ì•„ë‹ˆë¼ ë¸Œë¦¬ì§€ ì•„ë˜ ì „ì²´ Busì˜ ëª¨ë“  ë””ë°”ì´ìŠ¤ì— ì ìš©ëœë‹¤

ğŸ”¹ë”°ë¼ì„œ í•˜ë‚˜ì˜ ë””ë°”ì´ìŠ¤ë§Œ ì˜í–¥ì„ ë°›ëŠ” ê²Œ ì•„ë‹ˆë¼, í•˜ìœ„ ì—°ê²°ëœ ëª¨ë“  ì¥ì¹˜ê°€ ì¬í˜‘ìƒì„ ìˆ˜í–‰í•˜ê³ , ì„¤ì •ì´ ì´ˆê¸°í™”ëœë‹¤

#### 3) Hot Reset ë™ì‘ ê³¼ì •

1ï¸âƒ£ Root Complexê°€ Secondary Bus Reset Bitë¥¼ Set

* PCIe ìŠ¤ìœ„ì¹˜ ë˜ëŠ” ë¸Œë¦¬ì§€ ë””ë°”ì´ìŠ¤ì˜ Config Spaceì—ì„œ í•´ë‹¹ ë¹„íŠ¸ë¥¼ 1ë¡œ ì„¤ì •

2ï¸âƒ£ í•˜ìœ„ Busì— ì—°ê²°ëœ ëª¨ë“  ë””ë°”ì´ìŠ¤ ì´ˆê¸°í™”

* ê° ë””ë°”ì´ìŠ¤ì˜ ë‚´ë¶€ ë…¼ë¦¬ íšŒë¡œ ë° ìƒíƒœ ë¨¸ì‹  ì´ˆê¸°í™”

3ï¸âƒ£ Configuration Space ì´ˆê¸°í™”

* PCIeì˜ Config ì˜ì—­ (Device ID, Vendor ID, BAR ë“±)ì´ ì´ˆê¸°í™”ë˜ë©°,ì´ í›„ OS ë˜ëŠ” ë“œë¼ì´ë²„ê°€ ì´ë¥¼ ì¬ì„¤ì •í•´ì•¼ í•¨

4ï¸âƒ£ Link Training ì¬ì‹œì‘

* LTSSM(Link Training and Status State Machine)ì´ Detect ìƒíƒœë¡œ ì „ì´ë˜ì–´ Polling â†’ Configuration â†’ L0ë¡œ ì§„í–‰

5ï¸âƒ£ ì •ìƒ ë™ì‘ ìƒíƒœë¡œ ë³µê·€

* ê° ë””ë°”ì´ìŠ¤ëŠ” ë‹¤ì‹œ L0 ìƒíƒœë¡œ ë³µê·€í•˜ê³ , OSê°€ ì¬ì„¤ì • ì´í›„ë¶€í„° ì¥ì¹˜ë¥¼ ì •ìƒ ì‚¬ìš© ê°€ëŠ¥

#### 4) NVMe ê´€ì ì—ì„œì˜ ì˜í–¥

ğŸ”¸ Hot Resetì€ PCIe ë²„ìŠ¤ ë ˆë²¨ì—ì„œ ìˆ˜í–‰ë˜ì§€ë§Œ, NVMe ì»¨íŠ¸ë¡¤ëŸ¬ë„ ì§ì ‘ì ì¸ ì˜í–¥ì„ ë°›ìŒ.

ğŸ”¸ NVMe Controllerì˜ CC(Control Register), CSTS(Status Register), Admin Queue, I/O Queue, Memory Mapping ë“± ëª¨ë‘ ì´ˆê¸°í™”ë¨.

ğŸ”¸ ì§„í–‰ ì¤‘ì¸ I/O ëª…ë ¹ì€ ì¤‘ë‹¨ë˜ë©°, OSë‚˜ ë“œë¼ì´ë²„ê°€ NVMe ë””ë°”ì´ìŠ¤ë¥¼ ë‹¤ì‹œ ì´ˆê¸°í™”í•´ì•¼ í•¨.

ğŸ”¸ BAR ì¬í• ë‹¹, Identify ëª…ë ¹ ì¬ìˆ˜í–‰, í ì¬ìƒì„± ë“±ì´ í•„ìš”í•¨.

> ê²°ê³¼ì ìœ¼ë¡œ NVMe Controller Resetì— ê°€ê¹Œìš´ ìƒíƒœê°€ ë¨.

#### 5) ëª©ì  ë° í™œìš© ì‚¬ë¡€

ğŸ”¸ ë””ë°”ì´ìŠ¤ ì˜¤ë¥˜ ë³µêµ¬

 >ì»¨íŠ¸ë¡¤ëŸ¬ ì‘ë‹µ ì—†ìŒ ìƒíƒœì—ì„œ ì—°ê²°ì„ ì¬ìˆ˜ë¦½í•˜ì—¬ íšŒë³µ ìœ ë„

ğŸ”¸ ë§í¬ ì´ˆê¸°í™”

 > PCIe ì‹ í˜¸ ì„¤ì •(ì†ë„, ì „ì•• ë“±)ì´ ê¼¬ì˜€ì„ ë•Œ ë§í¬ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¼

ğŸ”¸ íŒì›¨ì–´ ì—…ë°ì´íŠ¸ í›„ ì—°ê²° ì¬ìˆ˜ë¦½

 > ì „ì› ì—†ì´ë„ ìƒˆë¡œìš´ ìƒíƒœë¡œ ë¦¬ì…‹ ê°€ëŠ¥

ğŸ”¸ PCIe ì—ëŸ¬ ë³µêµ¬

 > TLP ì˜¤ë¥˜, LCRC ì˜¤ë¥˜ ë“± ì§€ì†ì  ì „ì†¡ ì˜¤ë¥˜ ë°œìƒ ì‹œ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì‚¬ìš©

#### â­ Fundamental Reset ì¢…ë¥˜ ìš”ì•½ ë¹„êµâ­

| í•­ëª©                        | Cold Reset                          | Warm Reset                           | Hot Reset                                |
|----------------------------|-------------------------------------|--------------------------------------|-------------------------------------------|
| **Trigger**                | PERST# í•€ (í•˜ë“œì›¨ì–´ Trigger)        | Root Complex ì†Œí”„íŠ¸ì›¨ì–´ ì œì–´         | Secondary Bus Reset Bit (ì†Œí”„íŠ¸ì›¨ì–´ Trigger) |
| **ì „ì› ìƒíƒœ**              | Off â†’ On (ì „ì› ìˆœí™˜)                | On (ì „ì› ìœ ì§€)                       | On (ì „ì› ìœ ì§€)                             |
| **Configuration Space**    | ì´ˆê¸°í™”ë¨                            | ì´ˆê¸°í™”ë¨                             | ì´ˆê¸°í™”ë¨                                   |
| **Link Re-training**       | í•„ìš”í•¨ (LTSSM ì¬ì§„ì…)               | í•„ìš”í•¨                               | í•„ìš”í•¨                                     |
| **ì˜í–¥ ë²”ìœ„**              | ë‹¨ì¼ ë””ë°”ì´ìŠ¤                       | ë‹¨ì¼ ë””ë°”ì´ìŠ¤                        | í•˜ìœ„ Bus ì „ì²´                             |
| **PERST# ì‚¬ìš©**            | âœ… ì‚¬ìš©                              | âŒ ë¯¸ì‚¬ìš©                            | âŒ ë¯¸ì‚¬ìš©                                 |
| **ë³µêµ¬ ì‹œê°„**              | ê°€ì¥ ëŠë¦¼ (ì „ì› í¬í•¨)              | ì¤‘ê°„                                 | ì¤‘ê°„                                       |
| **ì£¼ ì‚¬ìš© ì‚¬ë¡€**           | ì‹œìŠ¤í…œ ì „ì› ì¬ë¶€íŒ…, ì „ì› ë³µêµ¬ ë“±     | ë””ë°”ì´ìŠ¤ ë…¼ë¦¬ ì´ˆê¸°í™”, ì•ˆì •ì  ë³µêµ¬ í•„ìš” ì‹œ | Bus í•˜ìœ„ ë””ë°”ì´ìŠ¤ ì˜¤ë¥˜ ë³µêµ¬, ìŠ¤ìœ„ì¹˜ ë¦¬ì…‹ ë“± |

### âœ… 6. Non-Fundamental Reset

#### 1) ê°œë…

ğŸ”¸ë””ë°”ì´ìŠ¤ì˜ PCIe Configuration Spaceë¥¼ ìœ ì§€í•œ ì±„, ì œí•œëœ ë²”ìœ„ì˜ ìƒíƒœë§Œ ë³µêµ¬í•˜ëŠ” ë¦¬ì…‹ ë°©ì‹

ğŸ”¸ì£¼ë¡œ Data Link Layer ìˆ˜ì¤€ì˜ ì˜¤ë¥˜ ë³µêµ¬, ì¼ì‹œì  ì¥ì•  ëŒ€ì‘, í†µì‹  ë³µì›ì„ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë¨

ğŸ”¸ë””ë°”ì´ìŠ¤ì˜ ë…¼ë¦¬ íšŒë¡œ ì „ì²´ë¥¼ ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ, ë”°ë¼ì„œ Cold/Warm/Hot Resetê³¼ êµ¬ë³„ë¨

#### 2)  Non-Fundamental Reset íŠ¸ë¦¬ê±° ìƒí™©

ğŸ”¹Data Link Layer ì˜¤ë¥˜: TLP CRC ì˜¤ë¥˜, LCRC ì˜¤ë¥˜ ë“±.

ğŸ”¹Replay Timer Expiry: ìˆ˜ì‹ ìê°€ ACKì„ ì œë•Œ ì£¼ì§€ ì•Šì„ ë•Œ ë°œìƒ.

ğŸ”¹LTSSMì˜ ì˜ˆì™¸ ì „ì´: ë§í¬ê°€ ì¼ì‹œì ìœ¼ë¡œ ë¶ˆì•ˆì •í•  ë•Œ Detect ìƒíƒœë¡œ ì „ì´.

ğŸ”¹Link Down ë³µêµ¬ ì‹œë„: ì¼ì‹œì ìœ¼ë¡œ Linkê°€ ëŠê¸´ í›„ ë‹¤ì‹œ ì˜¬ë¼ì˜¬ ë•Œ.

ğŸ”¹Surprise Down / Hot-Plug ì´ë²¤íŠ¸: ë””ë°”ì´ìŠ¤ ì‚½ì…/ì œê±° ìƒí™©ì—ì„œ ë¹„ì •ìƒ Link ë™ì‘ ë³µêµ¬.

### âœ… 7.  Function Level Reset (FLR)

#### 1) ê°œë…

ğŸ”¸PCIe ì¥ì¹˜ ë‚´ë¶€ì˜ íŠ¹ì • Functionë§Œ ì´ˆê¸°í™”í•˜ëŠ” ë¦¬ì…‹ ë°©ì‹

ğŸ”¸ì „í†µì ì¸ ë¦¬ì…‹ ë°©ì‹(Fundamental Reset)ê³¼ ë‹¬ë¦¬, ë””ë°”ì´ìŠ¤ ì „ì²´ê°€ ì•„ë‹Œ Function ë‹¨ìœ„ë¡œë§Œ ë¦¬ì…‹ë¨

ğŸ”¸Multi-function ë””ë°”ì´ìŠ¤ì—ì„œ ê°œë³„ ê¸°ëŠ¥ì„ ë¦¬ì…‹í•  ìˆ˜ ìˆëŠ” ìœ ì—°í•œ ë°©ë²•

> ì˜ˆë¥¼ ë“¤ì–´ NIC(Network Interface Card)ê°€ ì—¬ëŸ¬ Virtual Function(VF)ì„ ê°€ì§„ ê²½ìš° í•œ VFì— ì˜¤ë¥˜ê°€ ìˆì–´ë„ ì „ì²´ ë””ë°”ì´ìŠ¤ë¥¼ ë¦¬ì…‹í•˜ì§€ ì•Šê³  í•´ë‹¹ VFë§Œ ë¦¬ì…‹ ê°€ëŠ¥
>
> ê°€ìƒí™”(VM), SR-IOV í™˜ê²½ì—ì„œ ê° ê°€ìƒ ë¨¸ì‹ ì— ë…ë¦½ì ìœ¼ë¡œ Functionì„ í• ë‹¹í•˜ê³ , ë¬¸ì œê°€ ìƒê¸´ VMë§Œ ë¦¬ì…‹í•  ë•Œ ì‚¬ìš©.

#### 2) FLR íŠ¸ë¦¬ê±° ë°©ì‹

ğŸ”¸ì†Œí”„íŠ¸ì›¨ì–´ê°€ Functionì˜ PCIe Configuration Spaceì— ìˆëŠ” íŠ¹ì • ë ˆì§€ìŠ¤í„° (Command Register) ì— FLRì„ ìš”ì²­.

> `Initiate Function Level Reset` ëª…ë ¹ì„ í†µí•´ ìˆ˜í–‰ë¨.

#### 3) FLR ë™ì‘ ê³¼ì •

1ï¸âƒ£ OS ë˜ëŠ” Hypervisorê°€ FLR ìš”ì²­ (Functionì˜ Config ê³µê°„ì— ì“°ê¸°)

2ï¸âƒ£ í•´ë‹¹ Functionë§Œ ì´ˆê¸°í™”ë¨

* ë‚´ë¶€ ë…¼ë¦¬ íšŒë¡œ, ìƒíƒœ, ì»¨í…ìŠ¤íŠ¸ ë“± ì´ˆê¸°í™”

3ï¸âƒ£ ë‹¤ë¥¸ Functionì—ëŠ” ì˜í–¥ ì—†ìŒ

4ï¸âƒ£ PCIe ë§í¬ëŠ” ìœ ì§€ë¨ (Link Re-training ë¶ˆí•„ìš”)

5ï¸âƒ£ í•´ë‹¹ Functionì´ ë‹¤ì‹œ ì‚¬ìš© ê°€ëŠ¥í•´ì§

### âœ… ì¶”ê°€) NVMe Reset ì´í›„ ì´ˆê¸°í™” ì ˆì°¨ ë° Admin Queue ì •ë¦¬

#### 1) ë°°ê²½: ì™œ ì´ëŸ° ì´ˆê¸°í™”ê°€ í•„ìš”í•œê°€?

NVMe ë””ë°”ì´ìŠ¤ëŠ” **Reset (Controller Reset, Subsystem Reset, PCIe Hot/Cold Reset ë“±)** ì´í›„  **ëª¨ë“  ë…¼ë¦¬ ìƒíƒœì™€ í ì •ë³´ê°€ ìœ ì‹¤**ëœë‹¤.  

â¡ï¸ ë”°ë¼ì„œ **ë‹¤ì‹œ ì¥ì¹˜ë¥¼ "ì´ˆê¸°í™”"í•´ì£¼ëŠ” ëª…ë ¹ ì‹œí€€ìŠ¤ê°€ í•„ìš”**í•˜ë‹¤.

ì¦‰, ë¦¬ì…‹ì€ â€œì „ê¸°ì  ì´ˆê¸°í™”â€ì´ê³ , ì´ ì´í›„ì— â€œë…¼ë¦¬ì  ì´ˆê¸°í™”â€ë¥¼ **í˜¸ìŠ¤íŠ¸ê°€ ì§ì ‘ ìˆ˜í–‰**í•´ì•¼  ë””ë°”ì´ìŠ¤ë¥¼ ì •ìƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

#### 2) Reset ì´í›„ì˜ í•„ìˆ˜ ì´ˆê¸°í™” ìˆœì„œ

Reset ì´í›„ì—ëŠ” ë³´í†µ ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ NVMe ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì¬ì´ˆê¸°í™”í•œë‹¤:

| ìˆœë²ˆ | ë‹¨ê³„ | ì„¤ëª… |
|------|------|------|
| 1ï¸âƒ£ | **Admin Queue ìƒì„±** | ì»¨íŠ¸ë¡¤ëŸ¬ì™€ì˜ ëª…ë ¹ í†µì‹ ì„ ìœ„í•œ ê¸°ë³¸ ì±„ë„ |
| 2ï¸âƒ£ | **Identify Controller** | ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì •ë³´ ì¡°íšŒ (ìš©ëŸ‰, ê¸°ëŠ¥ ë“±) |
| 3ï¸âƒ£ | **Set Features** | ì›í•˜ëŠ” ë™ì‘ ëª¨ë“œ/ì„¤ì • ì ìš© (ex. í ê°œìˆ˜, IRQ ë“±) |
| 4ï¸âƒ£ | **Namespace Attach** | I/O ëª…ë ¹ì„ ë³´ë‚¼ ëŒ€ìƒ(Namespace)ì„ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì—°ê²° |
| 5ï¸âƒ£ | **I/O Queue ìƒì„±** | ì‹¤ì œ ë°ì´í„° ì†¡ìˆ˜ì‹ ìš© í (ê³ ì„±ëŠ¥ ë‹¤ì¤‘ í êµ¬ì„± ê°€ëŠ¥) |
| 6ï¸âƒ£ | **Identify Namespace** | ì—°ê²°ëœ Namespace ì •ë³´ ì¡°íšŒ (ìš©ëŸ‰, ìƒíƒœ ë“±) |

â¡ï¸ ì´ ì¼ë ¨ì˜ ì ˆì°¨ê°€ ëë‚˜ì•¼ NVMe ë””ë°”ì´ìŠ¤ëŠ” ì •ìƒì ì¸ I/Oë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ.

#### 3) Admin Queueë€?

Admin QueueëŠ” **NVMe ì»¨íŠ¸ë¡¤ëŸ¬ì™€ í†µì‹ ì„ ì‹œì‘í•  ë•Œ ë°˜ë“œì‹œ ë¨¼ì € ì„¤ì •í•´ì•¼ í•˜ëŠ” í ìŒ**ì´ë‹¤.

| êµ¬ì„± ìš”ì†Œ | ì„¤ëª… |
|-----------|------|
| **Submission Queue (SQ)** | í˜¸ìŠ¤íŠ¸ê°€ ëª…ë ¹ì„ â€œì ì–´ ë„£ëŠ”â€ í |
| **Completion Queue (CQ)** | ì»¨íŠ¸ë¡¤ëŸ¬ê°€ â€œëª…ë ¹ ì™„ë£Œâ€ë¥¼ ì•Œë¦¬ëŠ” í |
| **Admin Queue** | ìœ„ ë‘ íì˜ íŠ¹ë³„í•œ ì¸ìŠ¤í„´ìŠ¤, **ê´€ë¦¬ ëª…ë ¹ ì „ìš©** (Identify, Set Features ë“± ìˆ˜í–‰) |

#### 4) Admin Queue ìƒì„± ê³¼ì • (ë¦¬ì…‹ í›„)

> `(ë¦¬ì…‹ í›„ ì»¨íŠ¸ë¡¤ëŸ¬ ë¹„í™œì„±í™” ìƒíƒœ: CC.EN == 0)`

1ï¸âƒ£ **ASQ (Admin Submission Queue Base Address) ì„¤ì •**  

â†’ í˜¸ìŠ¤íŠ¸ê°€ ëª…ë ¹ì„ ì‘ì„±í•  ë²„í¼ ì£¼ì†Œ

2ï¸âƒ£ **ACQ (Admin Completion Queue Base Address) ì„¤ì •**  

â†’ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ Completionì„ ê¸°ë¡í•  ë²„í¼ ì£¼ì†Œ

3ï¸âƒ£ **AQA (Admin Queue Attributes) ì„¤ì •**  

â†’ íì˜ ì—”íŠ¸ë¦¬ ìˆ˜ ì„¤ì •

4ï¸âƒ£ **CC (Controller Configuration) ë ˆì§€ìŠ¤í„° ì„¤ì •**  

â†’ EN ë¹„íŠ¸ë¥¼ 1ë¡œ ì„¤ì •í•˜ì—¬ ì»¨íŠ¸ë¡¤ëŸ¬ í™œì„±í™”

5ï¸âƒ£ **CSTS (Controller Status) RDY == 1 í™•ì¸**  

â†’ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì´ˆê¸°í™” ì™„ë£Œë˜ê³  ë™ì‘ ì¤€ë¹„ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸

#### 5) Admin Queue ëª…ë ¹ ì²˜ë¦¬ íë¦„

ì´ì œ íê°€ ì„¤ì •ë˜ì—ˆìœ¼ë¯€ë¡œ, Admin ëª…ë ¹ì„ ë‹¤ìŒ íë¦„ìœ¼ë¡œ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆë‹¤:

#### ëª…ë ¹ ì „ì†¡ (í˜¸ìŠ¤íŠ¸ â†’ ì»¨íŠ¸ë¡¤ëŸ¬)

1ï¸âƒ£ í˜¸ìŠ¤íŠ¸ëŠ” **Submission Queue**ì— ëª…ë ¹ì„ ì‘ì„±í•œë‹¤  

> (ex: Identify ëª…ë ¹ = ì»¨íŠ¸ë¡¤ëŸ¬ ì •ë³´ ìš”ì²­)

2ï¸âƒ£ **Doorbell ë ˆì§€ìŠ¤í„°**ë¥¼ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ëª…ë ¹ì´ ì¤€ë¹„ë˜ì—ˆìŒì„ ì•Œë¦¼

#### ëª…ë ¹ ì²˜ë¦¬ (ì»¨íŠ¸ë¡¤ëŸ¬ â†’ í˜¸ìŠ¤íŠ¸)

3ï¸âƒ£ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ëª…ë ¹ì„ ì½ê³  ìˆ˜í–‰í•œ í›„, **Completion Queue**ì— ê²°ê³¼ë¥¼ ì‘ì„±

4ï¸âƒ£ í˜¸ìŠ¤íŠ¸ëŠ” CQì—ì„œ Completion Entryë¥¼ í™•ì¸í•˜ê³  ë‹¤ìŒ ë™ì‘ì„ ìˆ˜í–‰í•¨

> ì´ êµ¬ì¡°ëŠ” I/O ëª…ë ¹ì—ì„œë„ ë™ì¼í•˜ì§€ë§Œ,
> 
> **Admin QueueëŠ” ë¦¬ì…‹ ì§í›„ í•„ìˆ˜ ì„¤ì • ì±„ë„**ë¡œ ê°€ì¥ ë¨¼ì € ì‚¬ìš©ë¨

---
---
---
---
### ì´ ì•„ë˜ëŠ” ì˜ˆì „ì— ì •ë¦¬í•œ ë‚´ìš© -> ì¶”í›„ ìœ„ì— í•©ì¹˜ë©´ì„œ ì •ë¦¬í•  ì˜ˆì •
---

1. Controller Reset

2. Subsystem Reset

3. PCIe Hot Reset

4. PCIe Cold Reset

### â–¶ï¸ 1. Controller Reset

#### 1) ê°œë…

ğŸ”¸ NVMe ë””ë°”ì´ìŠ¤ì˜ í•˜ë‚˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë§Œ ë…¼ë¦¬ì ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ëŠ” ê³¼ì • (NVMe ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ê»ë‹¤ê°€ ë‹¤ì‹œ í‚¨ ëŠë‚Œ)

ğŸ”¸ Admin Queue, I/O Queue, Features ì„¤ì • ë“± ì»¨íŠ¸ë¡¤ëŸ¬ ê´€ë ¨ ìƒíƒœ ì •ë³´ ì „ì²´ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ëŠ” ì—­í• 

#### 2) êµ¬ì²´ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë™ì‘

ğŸ”¸ëª¨ë“  Submission/Completion Queueê°€ ì‚­ì œë¨

> `Submission Queue (SQ)` : í˜¸ìŠ¤íŠ¸ê°€ "ì´ê±° ì½ì–´ì¤˜", "ì´ê±° ì¨ì¤˜" í•˜ê³  ìš”ì²­ì„ ì ëŠ” ëª…ë ¹ ë¦¬ìŠ¤íŠ¸
>
> `Completion Queue (CQ)` : ì»¨íŠ¸ë¡¤ëŸ¬ê°€ "ì´ ìš”ì²­ ëë‚¬ì–´!" ë¼ê³  ê²°ê³¼ë¥¼ ì ì–´ì£¼ëŠ” ê³µê°„
>
> ë¦¬ì…‹ì´ ë˜ë©´ ì´ íë“¤ì´ ëª¨ë‘ ì‚¬ë¼ì ¸ì„œ, ì•„ë¬´ ëª…ë ¹ë„ ë³´ë‚¼ ìˆ˜ ì—†ê³  ë°›ì„ ìˆ˜ ì—†ìŒ

ğŸ”¸Features ëª…ë ¹ì–´ë¡œ ì„¤ì •ëœ íœ˜ë°œì„± ì„¤ì •(Volatile Features) ì´ˆê¸°í™”

> Features ëª…ë ¹ì€ NVMe ì¥ì¹˜ì˜ ì‘ë™ ë°©ì‹(ì„±ëŠ¥, ì „ë ¥ ë“±)ì„ ì¡°ì •í•˜ëŠ” ëª…ë ¹
>
> ì´ ì¤‘ ì¼ë¶€ëŠ” íœ˜ë°œì„±(volatile)ì´ë¼ì„œ, ì „ì›ì´ë‚˜ ë¦¬ì…‹ ì‹œ ì´ˆê¸°í™”(PM, Write Cache ë“±)

ğŸ”¸ëª…ë ¹ ëŒ€ê¸° ì¤‘ì¸ íì˜ ëª…ë ¹ì€ ì‹¤íŒ¨(Command Aborted) ì²˜ë¦¬

> ë¦¬ì…‹ì´ ë°œìƒí•  ë•Œ ì´ë¯¸ íì— ì˜¬ë¼ê°„ ëª…ë ¹(ì˜ˆ: ì½ê¸°/ì“°ê¸° ìš”ì²­)ì´ ìˆì—ˆë‹¤ë©´, ë§ˆë¬´ë¦¬í•˜ì§€ ì•Šê³  ê·¸ëƒ¥ í¬ê¸°

ğŸ”¸Identify ì •ë³´ë¥¼ ë‹¤ì‹œ íšë“í•´ì•¼ í•¨

> Identify ëª…ë ¹ì€ ë””ë°”ì´ìŠ¤ê°€ â€œë‚˜ ì´ëŸ° êµ¬ì¡°, ìš©ëŸ‰, í¬ë§·ì´ì•¼â€ ë¼ê³  ì •ë³´ë¥¼ ì•Œë ¤ì£¼ëŠ” ëª…ë ¹
>
> ì´ ëª…ë ¹ì„ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ ì •ë³´/ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì •ë³´ ë“±ì„ í™•ì¸

ğŸ”¸NamespaceëŠ” ë¹„í™œì„±í™” ìƒíƒœë¡œ ë˜ë©°, í•„ìš” ì‹œ ë‹¤ì‹œ Attach í•„ìš”

> Namespaceë€ ì‹¤ì œ ë°ì´í„° ì €ì¥ ê³µê°„(SSD íŒŒí‹°ì…˜ ê°™ì€ ê°œë…)
>
> Hostê°€ ì´ ê³µê°„ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” Attach(ì—°ê²°)ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.

#### 3) ìˆ˜í–‰ ë°©ë²•

ğŸ”¸NVMeì—ì„œ Controller Resetì€ ëª…ë ¹ì–´ ê¸°ë°˜ì´ ì•„ë‹ˆë¼, PCIeë¥¼ í†µí•œ ë ˆì§€ìŠ¤í„° ì¡°ì‘ìœ¼ë¡œ ìˆ˜í–‰

ğŸ”¸ì¦‰ NVMe ë ˆì§€ìŠ¤í„°ì˜ CC, CSTS ë“±ì€ PCI BAR ì˜ì—­ì„ í†µí•´ ë©”ëª¨ë¦¬ ì£¼ì†Œì— ë§¤í•‘ ë˜ë¯€ë¡œ, ì´ ì£¼ì†Œì— read/writeí•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•¨ìœ¼ë¡œì¨ ì¡°ì‘ ê°€ëŠ¥

#### 4) ë ˆì§€ìŠ¤í„° ë³€í™”: Controller Resetì€ ë‹¤ìŒ ë‘ ë ˆì§€ìŠ¤í„°ë¥¼ ì‚¬ìš©í•´ ìˆ˜í–‰

ğŸ”¸`CC (Controller Configuration Register)`

> EN (Enable) ë¹„íŠ¸ê°€ 0ì´ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ ë¹„í™œì„±í™” ìƒíƒœ -> ì´ ê°’ì„ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ ë¦¬ì…‹ì„ íŠ¸ë¦¬ê±°

ğŸ”¸`CSTS (Controller Status Register)`

> í˜„ì¬ ì»¨íŠ¸ë¡¤ëŸ¬ ìƒíƒœë¥¼ ë‚˜íƒ€ëƒ„ -> CSTS.RDY = 1 ì´ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ ì¤€ë¹„ ì™„ë£Œ, 0 ì´ë©´ ë¹„í™œì„±í™” ë˜ëŠ” ë¦¬ì…‹

#### 5) ë¦¬ì…‹ ì ˆì°¨
> 1. CC.EN = 0                       â† ì»¨íŠ¸ë¡¤ëŸ¬ ë¹„í™œì„±í™” ìš”ì²­
> 
> 2. Wait for CSTS.RDY = 0          â† ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë¹„í™œì„±í™” ë˜ì—ˆëŠ”ì§€ í™•ì¸
>    
> 3. (í•„ìš” ì‹œ Admin Queue ì„¤ì • ì¬ì‘ì„±)
>    
> 4. CC.EN = 1                       â† ì»¨íŠ¸ë¡¤ëŸ¬ ì¬í™œì„±í™”
>    
> 5. Wait for CSTS.RDY = 1          â† ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
>     
> 6. Identify ëª…ë ¹, Features ì¬ì„¤ì •, Namespace Attach ë“± ìˆ˜í–‰

### â–¶ï¸ 2. Subsystem Reset

#### 1) ê°œë…

ğŸ”¹ NVMe Subsystemì´ë€ í•˜ë‚˜ ì´ìƒì˜ NVMe Controllerì™€ Namespaceë“¤ì´ ì†Œì†ëœ ë…¼ë¦¬ì  ë‹¨ìœ„

ğŸ”¹ Subsystem Resetì€ ì´ ì „ì²´ ë¬¶ìŒì„ í•œ ë²ˆì— ë¦¬ì…‹ í•˜ëŠ” ê²ƒ(ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í¬í•¨í•œ ì „ì²´ NVMe ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”)

#### 2) Subsystem Resetì˜ íŠ¸ë¦¬ê±° ì¡°ê±´

: ìë™ ë°œìƒí•˜ê±°ë‚˜, í”Œë«í¼/íŒì›¨ì–´/OSì—ì„œ ì œì–´í•  ìˆ˜ ìˆë‹¤.

 ğŸ”¹CC.EN ë¹„íŠ¸ë¥¼ 0ìœ¼ë¡œ ì„¤ì •í–ˆëŠ”ë° CSTS.RDYê°€ 2ì´ˆ ì•ˆì— 0ì´ ë˜ì§€ ì•ŠìŒ

> ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‘ë‹µ ë¶ˆëŠ¥ì´ë¯€ë¡œ, ìë™ìœ¼ë¡œ Subsystem Reset ë°œìƒ

ğŸ”¹ PCIe Cold Reset (ì „ì› ì°¨ë‹¨) ì‹œ í¬í•¨

ğŸ”¹ íŒì›¨ì–´ ëª…ë ¹ ë˜ëŠ” ì‹œìŠ¤í…œ ì´ë²¤íŠ¸ë¡œ Subsystem ì „ì²´ ì´ˆê¸°í™”

ğŸ”¹ ë”°ë¼ì„œ Admin commandë¡œëŠ” ì¡°ì ˆ X 

> ì½”ë“œ ìƒìœ¼ë¡œ CC.ENê³¼ CSTS.RDY ìƒíƒœë¥¼ ì œì–´í•¨ìœ¼ë¡œì¨ ì¡°ì ˆ ê°€ëŠ¥

#### 3) ìˆ˜í–‰ ë™ì‘

: ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ë¦¬ì…‹, ëª¨ë“  í(Admin ë° I/O í) ì œê±°, ëª¨ë“  íœ˜ë°œì„± Features ì´ˆê¸°í™”, ëª¨ë“  ëª…ë ¹ ìƒíƒœ ì¤‘ê°„, ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì—°ê²° ë¹„í™œì„±í™”(ë‹¤ì‹œ Attach í•„ìš”) ë“±

#### 4) ë ˆì§€ìŠ¤í„° ë° ë™ì‘ íë¦„

: Subsystem Resetì€ ì–´ë–¤ ë‹¨ì¼ ë ˆì§€ìŠ¤í„°ë¥¼ writeí•´ì„œ ì§ì ‘ ìˆ˜í–‰í•˜ì§€ëŠ” ì•Šì§€ë§Œ, ë³´í†µ Controller Disable ì‹¤íŒ¨ ìƒí™©ì´ ë°œìƒí•˜ë©´ íŠ¸ë¦¬ê±° ë¨

> "Controller Disable ì‹¤íŒ¨"ë€ CC.EN=0 í›„ CSTS.RDY=0 ë¯¸ ë„ë‹¬ì¸ ê²½ìš°

ğŸ”¹CC (Controller Configuration) 

> CC.EN = 0: ë¹„í™œì„±í™” ìš”ì²­

ğŸ”¹CSTS (Controller Status) 

> RDY ë¹„íŠ¸ê°€ 2ì´ˆ ì•ˆì— 0ì´ ì•ˆ ë˜ë©´ â†’ Subsystem Reset ë°œìƒ

#### 5) ìˆ˜í–‰ íë¦„

> 1. OSê°€ CC.EN = 0ìœ¼ë¡œ ì„¤ì • (Controller Disable ì‹œë„)
>    
> 2. CSTS.RDY != 0 ìƒíƒœê°€ 2ì´ˆ ì´ìƒ ìœ ì§€ë¨
>  
> 3. ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‘ë‹µ ì—†ìŒìœ¼ë¡œ íŒë‹¨ë¨
>  
> 4. íŒì›¨ì–´ ë˜ëŠ” í”Œë«í¼ì´ Subsystem Resetì„ ê°•ì œ ìˆ˜í–‰
> 
> 5. ì´í›„ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ë° ìì›ì´ ì¬ì´ˆê¸°í™”ë¨
â€ƒ
### â–¶ï¸ 3. PCIe Hot Reset

#### 1) ê°œë…

ğŸ”¸ PCIe Hot Resetì€ PCI Express ë§í¬ ìƒì˜ ë””ë°”ì´ìŠ¤ ì—°ê²°ì„ ëŠê³  ë‹¤ì‹œ ì¬ ì—°ê²°í•˜ëŠ” ë™ì‘

ğŸ”¸ í”íˆ "PCIe ì¥ì¹˜ê°€ ëºë‹¤ ë‹¤ì‹œ ê½‚íŒ ê²ƒì²˜ëŸ¼" ë…¼ë¦¬ì ìœ¼ë¡œ ì¬í˜‘ìƒ(link re-training)ì„ ìˆ˜í–‰

ğŸ”¸ ì „ì›ì€ ê³„ì† ì—°ê²°ë˜ì–´ ìˆê³  ì‹ í˜¸ë§Œ ëŠìŒìœ¼ë¡œì¨ â€œë‹¤ì‹œ ì—°ê²°ë˜ì—ˆêµ¬ë‚˜â€ë¼ê³  ëŠë¼ë„ë¡

#### 2) ëª©ì 

ğŸ”¸ ë””ë°”ì´ìŠ¤ ì˜¤ë¥˜ ë³µêµ¬

> ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë¨¹í†µì¼ ë•Œ ì¬ì—°ê²°ì„ ì‹œë„í•˜ì—¬ recoveryë¥¼ ìœ ë„

ğŸ”¸ ë§í¬ ì´ˆê¸°í™”

> ì „ì†¡ ì†ë„ë‚˜ ì„¤ì •ì´ ê¼¬ì˜€ì„ ë•Œ ê°€ì‹œ ì´ˆê¸° ìƒíƒœë¡œ ë§ì¶”ê¸°

ğŸ”¸ íŒì›¨ì–´ ì—…ë°ì´íŠ¸ í›„ ì—°ê²° íšŒë³µ 

> ì „ì›ì„ ë„ì§€ ì•Šê³ ë„ ë””ë°”ì´ìŠ¤ ì „ì²´ ë™ì‘ ìƒíƒœ ì´ˆê¸°í™” ê°€ëŠ¥ 

ğŸ”¸ PCIe ì—ëŸ¬ ë³µêµ¬ 

> Transaction Layer Packet(TLP) ì˜¤ë¥˜ê°€ ê³„ì† ë°œìƒí•  ê²½ìš° recovery

#### 3) ìˆ˜í–‰ ë™ì‘

ğŸ”¸ PCIeë§í¬ ì¬í›ˆë ¨ ë°œìƒ : L0 â†’ Detect â†’ L0 

ğŸ”¸ Configuration ê³µê°„ ì´ˆê¸°í™”(BAR, IDë“±) -> OSê°€ ì¬ì„¤ì • í•´ì•¼í•¨

ğŸ”¸ NVMe ì»¨íŠ¸ë¡¤ëŸ¬ì˜ CC, CSTS, í, ì„¤ì • ëª¨ë‘ ì´ˆê¸°í™”ë¨(Controller Resetê³¼ ë¹„ìŠ·í•œ ìƒíƒœ)

ğŸ”¸ ë©”ëª¨ë¦¬ ë§¤í•‘(MMIO) BARì£¼ì†Œ ì¬í• ë‹¹ í•„ìš”

ğŸ”¸ ì§„í–‰ ì¤‘ì¸ I/Oëª…ë ¹ ëª¨ë‘ ì¤‘ë‹¨
â€ƒ
### â–¶ï¸ 4. PCIe Cold Reset (= PCIe Conventional Reset or Fundamental Reset)

#### 1) ê°œë…

ğŸ”¹ PCIe Cold Resetì€ ì¥ì¹˜ì˜ ì „ì›ì„ ì™„ì „íˆ ê»ë‹¤ê°€ ë‹¤ì‹œ ì¼œëŠ” ë¦¬ì…‹

ğŸ”¹ ë¬¼ë¦¬ì ìœ¼ë¡œë“  ë…¼ë¦¬ì ìœ¼ë¡œë“ , ì´ Resetì€ ì‹œìŠ¤í…œì´ í•´ë‹¹ ì¥ì¹˜ë¥¼ ì²˜ìŒ ë¶€íŒ…í–ˆì„ ë•Œì™€ ê°™ì€ ìƒíƒœë¡œ ë˜ëŒë¦¼

ğŸ”¹ ì „ì§€ê°€ ì™„ì „íˆ ì°¨ë‹¨ë˜ë¯€ë¡œ ì¥ì¹˜ì˜ ëª¨ë“  íœ˜ë°œì„± ì •ë³´(MMIO ìƒíƒœ, Queue, ì»¨íŠ¸ë¡¤ëŸ¬ ë ˆì§€ìŠ¤í„°, DRAM) ë“±ì´ ì™„ì „íˆ ì´ˆê¸°í™”ë¨

> ë‹¨ìˆœíˆ ëª…ë ¹ íë‚˜ ì„¤ì •ë§Œ ì§€ìš°ëŠ” ê²Œ ì•„ë‹ˆë¼, í•˜ë“œì›¨ì–´ ìì²´ë¥¼ ë‹¤ì‹œ ë¶€íŒ…ì‹œí‚¤ëŠ” ìˆ˜ì¤€

#### 2) ìˆ˜í–‰ë˜ëŠ” ë°©ë²•

ğŸ”¹ ë¬¼ë¦¬ì  ì „ì› ì°¨ë‹¨: ì„œë²„ ë˜ëŠ” ì‹œìŠ¤í…œì´ PCIe ìŠ¬ë¡¯ì— ê³µê¸‰ë˜ëŠ” ì „ì›ì„ ëŠì—ˆë‹¤ê°€ ë‹¤ì‹œ ë„£ìŒ

ğŸ”¹ì‹œìŠ¤í…œ ë˜ëŠ” íŒì›¨ì–´ íŠ¸ë¦¬ê±°: BIOS/UEFI, BMC, ACPI ë“±ì´ ì œì–´í•˜ì—¬ ì¥ì¹˜ ì „ì›ì„ ë¦¬ì‚¬ì´í´

ğŸ”¹ ì „ì› ìì²´ë¥¼ ëŠëŠ” ë°©ë²•ì´ë¯€ë¡œ **ì½”ë“œ ìƒìœ¼ë¡œ êµ¬í˜„ ë¶ˆê°€ëŠ¥**

### â•â• 5. ì¶”ê°€ ë‚´ìš©

ğŸ”† Reset ì´í›„ì˜ ì´ˆê¸°í™” ìˆœì„œ (ëª¨ë“  Reset ì´í›„ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ì¥ì¹˜ë¥¼ ì¬ì´ˆê¸°í™”í•´ì•¼ ì •ìƒ ë™ì‘)

> 1. Admin Queue ìƒì„±
>
> 2. Identify Controller ìˆ˜í–‰
>
> 3. í•„ìš”í•œ Features ì„¤ì •
>
> 4. Namespace Attach
>
> 5. I/O Queue ìƒì„±
>
> 6. Identify Namespace ìˆ˜í–‰

ğŸ”† Admin Queue (Submission Queue, Completion Queue)ì— ëŒ€í•´ì„œ

â—¾ ê¸°ë³¸ ê°œë… ì •ë¦¬

â–«ï¸ `Submission Queue` : Hostê°€ NVMe ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ëª…ë ¹ì„ â€œì ì–´ ë„£ëŠ”â€ ê³µê°„

â–«ï¸ `Completion Queue` : NVMe ì»¨íŠ¸ë¡¤ëŸ¬ê°€ â€œì´ ëª…ë ¹ ëë‚¬ì–´â€ë¼ëŠ” ê²°ê³¼ë¥¼ Hostì— ì•Œë ¤ì£¼ëŠ” ê³µê°„

â–«ï¸ `Admin Queue` : ì´ SQ/CQì˜ íŠ¹ìˆ˜í•œ ì¸ìŠ¤í„´ìŠ¤

> Admin ëª…ë ¹ ì „ìš© (Identify, Features ë“±)

â—¾ Admin Queueì˜ ìƒì„± íë¦„

> 1. ë¦¬ì…‹ í›„ CC.EN = 0 ìœ ì§€
>
> 2. ASQ, ACQ, AQA ë ˆì§€ìŠ¤í„° ì„¤ì • (ì£¼ì†Œ + í¬ê¸°)
>
> 3. CC ë ˆì§€ìŠ¤í„° ì„¤ì • â†’ EN ë¹„íŠ¸ = 1 (ì»¨íŠ¸ë¡¤ëŸ¬ í™œì„±í™”)
>
> 4. CSTS.RDY == 1 ë˜ëŠ”ì§€ í™•ì¸
>
> 5. ì´ì œ Admin Queueë¥¼ í†µí•´ Identify, Set Features ë“± ê°€ëŠ¥

â—¾ Admin Queueë¡œ ëª…ë ¹ ì „ì†¡í•˜ëŠ” ê³¼ì •

> HostëŠ” SQì— ëª…ë ¹ (ì˜ˆ: Identify)ì„ ì‘ì„±
>
> Doorbell (DB) ë ˆì§€ìŠ¤í„°ë¥¼ ì´ìš©í•´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ì•Œë¦¼
> 
> ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ëª…ë ¹ ìˆ˜í–‰ í›„ CQì— Completion Entry ì‘ì„±
> 
> HostëŠ” CQì—ì„œ Completion ì½ê³  ì²˜ë¦¬
